<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Editar CAPEX — {{ plan.code }} {{ plan.name }}</title>
  <style>
    :root{ --neo-green:#7AC143; --neo-deep:#0F3A1F; --bg:#F4FBF2; }
    body{margin:0;font-family:Inter,Arial;background:linear-gradient(#F7FBF5,var(--bg));color:#10301C}
    .topbar{position:sticky;top:0;background:linear-gradient(90deg,var(--neo-deep),#0B2F19 70%);color:#EFFFF0;padding:14px 20px}
    .wrap{max-width:820px;margin:20px auto;padding:0 20px}
    .board{background:#fff;border:1px solid #e6efe6;border-radius:14px;box-shadow:0 12px 28px rgba(15,58,31,.12);padding:18px}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:8px 10px;border-bottom:1px solid #e7eee7;font-size:13px}
    th{text-align:left}
    .num-input{width:120px;text-align:right}
    .row-footer{display:flex;gap:14px;margin-top:14px;align-items:center}
    .btn{background:#E8F6E2;border:1px solid #CBE9C2;color:#0B3D22;padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer}
  </style>
</head>
<body>
<header class="topbar"><strong>Editar {{ plan.code }} — {{ plan.name }} ({{ year }})</strong></header>
<main class="wrap">
  <section class="board">
    <form method="post">
      {% csrf_token %}
      <table>
        <thead><tr><th>Mês</th><th>Realizado</th><th>Previsto (editar)</th></tr></thead>
        <tbody>
          {% for form in formset.forms %}
            {% with obj=form.instance %}
            <tr>
              <td>{{ obj.mes }}</td>
              <td style="text-align:right">{{ obj.realizado|floatformat:3 }}</td>
              <td>
                {% if obj.realizado and obj.realizado != 0 %}
                  <input type="number" class="num-input" value="{{ obj.previsto|floatformat:3 }}" disabled>
                {% else %}
                  {{ form.previsto }}
                {% endif %}
              </td>
            </tr>
            {% endwith %}
          {% endfor %}
        </tbody>
      </table>

      <h4>Transferências</h4>
      <div>
        {{ transf_form.valor.label_tag }} {{ transf_form.valor }}
      </div>
      <div style="margin-top:6px">
        {{ transf_form.de_para.label_tag }} {{ transf_form.de_para }}
      </div>

      <div class="row-footer">
        <button class="btn" type="submit">Salvar</button>
        <a class="btn" href="{% url 'capex' %}">Voltar</a>
        <span style="margin-left:auto">MELHOR VISÃO: <b>{{ resumo.melhor_visao|floatformat:3 }}</b> | REV3: <b>{{ resumo.rev3|floatformat:3 }}</b> | Saldo: <b>{{ resumo.saldo|floatformat:3 }}</b></span>
      </div>
    </form>
  </section>
</main>
</body>
</html>